@page "/phieunhapkho/detail/{id:int}"
@using TKS_intern_client.Services
@using TKS_intern_client.Shared.Tables
@using TKS_intern_shared.ViewModels.ChiTietPhieuNhapKhos
@using TKS_intern_shared.ViewModels.PhieuNhapKhos
@inject ApiClient Api
@inject NavigationManager Navigation
@inject IJSRuntime JS

<PageHeader Title="Chi tiết phiếu nhập kho"
            SubTitle="Xem thông tin chi tiết">
    <PageHeaderBreadcrumb>
        <Breadcrumb>
            <BreadcrumbItem>Home</BreadcrumbItem>
            <BreadcrumbItem Href="/phieunhapkho">Phiếu nhập kho</BreadcrumbItem>
            <BreadcrumbItem>Chi tiết phiếu</BreadcrumbItem>
        </Breadcrumb>
    </PageHeaderBreadcrumb>
    <PageHeaderExtra>
        <Button Type="ButtonType.Primary" @onclick="Back">
            <Icon Type="left" Theme="IconThemeType.Outline" /> Quay lại
        </Button>
    </PageHeaderExtra>
</PageHeader>

@if (phieu == null)
{
    <Skeleton Active="true" Title="true" ParagraphRows="4" />
}
else
{
    <Card Title="Thông tin phiếu" Bordered="true" Class="mb-4">
        <Extra>
            <a href="@($"/phieunhapkho/edit/{phieu.Id}")">
                <Button Type="ButtonType.Link">
                    <Icon Type="edit" Theme="IconThemeType.Outline" /> Chỉnh sửa
                </Button>
            </a>

            <a href="@($"/phieunhapkho/print/{phieu.Id}")" target="_blank">
                <Button Type="ButtonType.Dashed">
                    <Icon Type="printer" Theme="IconThemeType.Outline" /> In phiếu
                </Button>
            </a>
        </Extra>
        <Body>
            <Descriptions Column="2" Bordered="true" Size="DescriptionsSize.Small">
                <DescriptionsItem Title="Số Phiếu">
                    @phieu.SoPhieuNhapKho
                </DescriptionsItem>
                <DescriptionsItem Title="Kho">
                    <Tag Color="TagColor.Blue">@phieu.Kho?.TenKho</Tag>
                </DescriptionsItem>
                <DescriptionsItem Title="Nhà Cung Cấp">
                    <Tag Color="TagColor.Lime">@phieu.NhaCungCap?.TenNhaCungCap</Tag>
                </DescriptionsItem>
                <DescriptionsItem Title="Ngày Nhập">
                    @phieu.NgayNhapKho.ToString("dd/MM/yyyy HH:mm")
                </DescriptionsItem>
                <DescriptionsItem Title="Ghi Chú">
                    @phieu.GhiChu
                </DescriptionsItem>
                <DescriptionsItem Title="Ngày Tạo">
                    @phieu.CreatedAt.ToString("dd/MM/yyyy HH:mm")
                </DescriptionsItem>
                <DescriptionsItem Title="Ngày Cập Nhật">
                    @phieu.UpdatedAt.ToString("dd/MM/yyyy HH:mm")
                </DescriptionsItem>
            </Descriptions>
        </Body>
    </Card>

    <Card Title="Chi tiết sản phẩm" Bordered="true">
        @if (ChiTietPhieuNhapKhos == null || !ChiTietPhieuNhapKhos.Any())
        {
            <Empty>
                <DescriptionTemplate>
                    <span>Hiện không có chi tiết phiếu nhập nào.</span>
                </DescriptionTemplate>
                <ChildContent>
                    <Button Type="ButtonType.Primary">Thêm chi tiết</Button>
                </ChildContent>
            </Empty>
        }
        else
        {
            <ChiTietPhieuNhapKhoTable Items="ChiTietPhieuNhapKhos" />
        }

        <Divider />
        <Button Type="ButtonType.Default" @onclick="Back">Quay lại</Button>
    </Card>
}

@code {
    [Parameter] public int id { get; set; }

    private PhieuNhapKhoVM? phieu;
    private List<ChiTietPhieuNhapKhoVM>? ChiTietPhieuNhapKhos;

    protected override async Task OnInitializedAsync()
    {
        phieu = await Api.GetAsync<PhieuNhapKhoVM>($"api/PhieuNhapKhos/{id}");
        if (phieu == null)
        {
            await JS.InvokeVoidAsync("alert", "Không tìm thấy phiếu nhập kho.");
            Navigation.NavigateTo("/phieunhapkho");
            return;
        }

        ChiTietPhieuNhapKhos = await Api.GetAsync<List<ChiTietPhieuNhapKhoVM>>(
            $"api/ChiTietPhieuNhapKhos/phieuNhapKho/{id}"
        );
    }

    private void Back()
    {
        Navigation.NavigateTo("/phieunhapkho");
    }
}
