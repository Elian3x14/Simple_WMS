    @page "/phieunhapkho"
@using TKS_intern_client.Services
@using TKS_intern_shared.ViewModels.PhieuNhapKhos
@inject ApiClient Api
@inject NavigationManager Navigation
@inject IJSRuntime JS

<PageTitle>Phiếu Nhập Kho</PageTitle>

<Breadcrumb>
    <BreadcrumbItem Href="/">Home</BreadcrumbItem>
    <BreadcrumbItem>Phiếu nhập kho</BreadcrumbItem>
</Breadcrumb>

<Title Level="3">Danh sách Phiếu Nhập Kho</Title>

<Space class="mb-3">
    <SpaceItem>
        <a href="/phieunhapkho/create">
            <AntDesign.Button Type="ButtonType.Primary" Icon="@IconType.Outline.Plus">
                Thêm mới
            </AntDesign.Button>
        </a>
    </SpaceItem>
    <SpaceItem>
        <a href="/baocao/nhap">
            <Button Type="ButtonType.Dashed" Icon="@IconType.Outline.FileText">
                Xem báo cáo
            </Button>
        </a>
    </SpaceItem>
</Space>

@if (phieuNhapKhoList == null)
{
    <Spin Tip="Đang tải dữ liệu..." />
}
else if (!phieuNhapKhoList.Any())
{
    <Empty>
        <DescriptionTemplate>
            <span>Không có phiếu nhập nào</span>
        </DescriptionTemplate>
        <ChildContent>
            <Button Type="ButtonType.Primary">Thêm phiếu mới</Button>
        </ChildContent>
    </Empty>
}
else
{
    <Table TItem="PhieuNhapKhoVM" DataSource="phieuNhapKhoList">
        <PropertyColumn Property="x => x.Id" Title="ID">
            @context.Id
        </PropertyColumn>

        <PropertyColumn Property="x => x.SoPhieuNhapKho" Title="Số Phiếu" />

        <Column TData="PhieuNhapKhoVM" Title="Kho">
            <Template>@context.Kho?.TenKho</Template>
        </Column>

        <Column TData="PhieuNhapKhoVM" Title="Nhà Cung Cấp">
            <Template>@context.NhaCungCap?.TenNhaCungCap</Template>
        </Column>


        <Column TData="PhieuNhapKhoVM" Title="Ngày Nhập">
            <Template>@context.NgayNhapKho.ToString("dd/MM/yyyy HH:mm")</Template>
        </Column>

        <PropertyColumn Property="x => x.GhiChu" Title="Ghi chú" />


        <Column TData="PhieuNhapKhoVM" Title="Ngày Tạo">
            <Template>@context.CreatedAt.ToString("dd/MM/yyyy HH:mm")</Template>
        </Column>



        <Column TData="PhieuNhapKhoVM" Title="Ngày Cập Nhật">
            <Template>@context.UpdatedAt.ToString("dd/MM/yyyy HH:mm")</Template>
        </Column>

        <ActionColumn Title="Hành động">
            <Template>
                <Space Size="SpaceSize.Small">
                    <a href=@($"/phieunhapkho/detail/{context.Id}")>
                        <Button Size="ButtonSize.Small" Type="ButtonType.Link">
                            <Icon Type="eye" Theme="IconThemeType.Outline" />
                        </Button>
                    </a>
                    <a href=@($"/phieunhapkho/edit/{context.Id}")>
                        <Button Size="ButtonSize.Small" Type="ButtonType.Text">
                            <Icon Type="edit" Theme="IconThemeType.Outline" />
                        </Button>
                    </a>
                    <Button Size="ButtonSize.Small" Type="ButtonType.Text" Danger
                            OnClick="()=>DeletePhieuNhapKho(context.Id)">
                        <Icon Type="delete" Theme="IconThemeType.Outline" />
                    </Button>
                </Space>
            </Template>
        </ActionColumn>
    </Table>
}

@code {
    private List<PhieuNhapKhoVM>? phieuNhapKhoList;
    

    protected override async Task OnInitializedAsync()
    {
        await LoadData();
    }

    private async Task LoadData()
    {
        phieuNhapKhoList = await Api.GetAsync<List<PhieuNhapKhoVM>>("api/PhieuNhapKhos");
    }

    private async Task DeletePhieuNhapKho(int id)
    {
        var confirm = await JS.InvokeAsync<bool>("confirm", $"Bạn có chắc muốn xóa phiếu nhập kho ID {id}?");
        if (confirm)
        {
            var response = await Api.DeleteAsync($"api/PhieuNhapKhos/{id}");
            if (response.IsSuccessStatusCode)
            {
                await LoadData();
            }
            else
            {
                Console.WriteLine($"Xóa thất bại: {response.StatusCode}");
            }
        }
    }
}
